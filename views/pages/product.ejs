<%- include('../partials/header') %>

<body class="h-100" style="background-color: rgb(248, 248, 248);">

  <div class="container-md mt-5">
    <div>
      <h2>สินค้า</h2>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">หน้าแรก</a></li>
        <li class="breadcrumb-item active">สินค้า</li>
      </ol>
    </div>
    <div class="mt-3">
      <!-- <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle w-100" type="button" data-mdb-toggle="dropdown" aria-expanded="false">
          Dropdown button
        </button>
        <ul class="dropdown-menu dropdown-menu-dark w-100">
          <li><a class="dropdown-item active" href="#">Action</a></li>
          <li><a class="dropdown-item" href="#">Another action</a></li>
          <li><a class="dropdown-item" href="#">Something else here</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="#">Separated link</a></li>
        </ul>
      </div> -->

      <div class="d-flex mb-5" id="rs-productList">
        <!-- ประเภท -->
        <ul class="cate-select-group me-3">
          <li href="/product/all" class="cate-button cate-active" data-target="allSection">
            สินค้าทั้งหมด</li>
          <!-- <li class="cate-button" data-target="cardSection">นามบัตร</li>
          <li class="cate-button" data-target="flyerSection">ใบปลิว</li>
          <li class="cate-button" data-target="leafletSection">แผ่บพับ</li> -->
          <li class="cate-button" data-target="billSection">ใบบิล</li>
          <li class="cate-button" data-target="stickerSection">สติ๊กเกอร์</li>
          <li class="cate-button" data-target="envelopeSection">ซองจดหมาย</li>
        </ul>

        <% const cate = ["sticker", "bill", "envelope"] %>
        <!-- สินค้าทั้งหมด -->
        <% let foundItem = false; %>
        <% let pronoun; %>

        <div class="itemlist " id="allSection">
          <% if(products.length > 0){ %>
          <% products.forEach((product) => { %>
          <div class="card m-1 p-3 mb-4 <%= product.status == 0 ? 'product-refrain' : '' %> ">
            <% if (promotions.some(promo => promo.product_id === product.product_id)) { %>
            <div class="promo-sign">
              <% promotions.forEach((promo) => { %>
              <% if (promo.product_id === product.product_id) { %>
                <i class="fa-solid fa-bullhorn text-light me-2"></i><%= promo.promo_name %>
              <% } %>
              <% }) %>
            </div>
            <% } %>
            <a href="/product/item/<%= product.product_id %>">
              <div class="pb-1 product_list_card" data-bs-toggle="modal" data-id="<%= product.product_id %>"
                data-cate="<%= product.categories %>">
                <% if(product.status == 0) { %>
                <div class="refrain-sign">
                  งดรับทำ
                </div>
                <% } %>
                <img src="<%= product.picture %>" class="img-fluid rounded" draggable="false" />
              </div>
            </a>
            <div class="card-body p-0 mt-3">
              <h5 class="card-title"><%= product.productName %></h5>
              <p class="card-text text-truncate des"><%= product.description %></p>
            </div>
            <div class="price">
              <% const findPrice = priceTiers.filter(price => price.product_id === product.product_id) %>
              <% let sum = findPrice[0].price * findPrice[0].quantity %>
              <span>ราคาเริ่มต้น <%= parseFloat(sum).toFixed(0) %> บาท ต่อ <%= findPrice[0].quantity %> ชิ้น</span>
            </div>
            <a href="/product/item/<%= product.product_id %>">
              <div class="w-100">
                <button
                  class="btn btn-primary w-100 enter-product fs-6 <%= product.status == 0 ? 'refrain-button' : '' %>"
                  data-bs-toggle="modal" data-id="<%= product.product_id %>"
                  data-cate="<%= product.categories %>">สั่งทำ</button>
              </div>
            </a>
          </div>
          <% }); %>
          <% } else { %>
          <b class="m-auto">ไม่มีสินค้าที่วางขายตอนนี้</b>
          <% } %>
        </div>

        <% for( let i = 0; i < cate.length; i++ ) { %>
        <div class="itemlist" id="<%= cate[i] %>Section">
          <% let categoryFound = false; %>
          <% if(products.length > 0){ %>
          <% products.forEach((product) => { %>
          <% if(product.categories === cate[i]){ %>
          <% categoryFound = true; %>
          <div class="card m-1 p-3 mb-4 <%= product.status == 0 ? 'product-refrain' : '' %> ">
            <% if (promotions.some(promo => promo.product_id === product.product_id)) { %>
            <div class="promo-sign">
              <% promotions.forEach((promo) => { %>
              <% if (promo.product_id === product.product_id) { %>
                <i class="fa-solid fa-bullhorn text-light me-2"></i><%= promo.promo_name %>
              <% } %>
              <% }) %>
            </div>
            <% } %>
            <a href="/product/item/<%= product.product_id %>">
              <div class="pb-1 product_list_card" data-bs-toggle="modal" data-id="<%= product.product_id %>"
                data-cate="<%= product.categories %>">
                <% if(product.status == 0) { %>
                <div class="refrain-sign">
                  งดรับทำ
                </div>
                <% } %>
                <img src="<%= product.picture %>" class="img-fluid rounded" draggable="false" />
              </div>
            </a>
            <div class="card-body p-0 mt-3">
              <h5 class="card-title"><%= product.productName %></h5>
              <p class="card-text text-truncate des"><%= product.description %></p>
            </div>
            <div class="price">
              <% const findPrice = priceTiers.filter(price => price.product_id === product.product_id) %>
              <% let sum = findPrice[0].price * findPrice[0].quantity %>
              <span>ราคาเริ่มต้น <%= parseFloat(sum).toFixed(0) %> บาท ต่อ <%= findPrice[0].quantity %> ชิ้น</span>
            </div>
            <a href="/product/item/<%= product.product_id %>">
              <div class="w-100">
                <button
                  class="btn btn-primary w-100 enter-product fs-6 <%= product.status == 0 ? 'refrain-button' : '' %>"
                  data-bs-toggle="modal" data-id="<%= product.product_id %>"
                  data-cate="<%= product.categories %>">สั่งทำ</button>
              </div>
            </a>
          </div>
          <% found = true; %>
          <% } %>
          <% }); %>
          <% } %>
          <% if (!categoryFound) {%>
          <b class="m-auto fs-4">ยังไม่มีสินค้าประเภทนี้</b>
          <% } %>
        </div>
        <% } %>

      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $('#cardSection').hide();
      $('#flyerSection').hide();
      $('#leafletSection').hide();
      $('#stickerSection').hide();
      $('#billSection').hide();
      $('#envelopeSection').hide();
    });

    $(document).ready(function () {
      $(".cate-button").on("click", function () {
        const targetSection = $(this).data("target");
        $(".cate-button").removeClass("cate-active");
        $(this).addClass("cate-active");
        $(".itemlist").hide();
        $("#" + targetSection).show();
      });

      $(".enter-product, .product_list_card").on("click", function () {
        const id = $(this).data('id');
        const cate = $(this).data('cate');

        $("#product_id").val(id);

        var link = $('#product-link');
        var hrefValue = '/product/item/' + id;
        link.attr('href', hrefValue);

      })

      // $('#product_id').on('input', function () {
      //   var id = $(this).val();
      //   var link = $('#product-link');
      //   var hrefValue = '/product/item/' + id;
      //   link.attr('href', hrefValue);
      // });
    });
  </script>
</body>



<%- include('../partials/footer') %>
<%- include('../partials/chat') %>