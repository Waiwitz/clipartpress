<%- include('../partials/header') %>

<body>
    <div class="container-lg mt-5">
        <div class="d-flex justify-content-between">
            <div class="left-box-product">
                <div class="card productPic">
                    <div class="card-body p-0">
                        <span class="product_name"><%= product.productName %></span>
                        <div class="product_img">
                            <img src="<%= product.picture %>" alt="" class="imageFitBox" draggable="false">
                        </div>
                    </div>
                </div>
                <div class="card select-conclusion">
                    <div class="card-header">
                        <h3>สรุปสิ่งที่เลือก</h3>
                    </div>
                    <div class="card-body">
                        <% let i = 0; %>
                        <% for (var optionName in options) { %>
                        <% i++ %>
                        <% if (options.hasOwnProperty(optionName)) { %>
                        <div class="col">
                            <h4><%= optionName %></h4>
                            <p class="select-option" id="select-option-<%= i %>"></p>
                        </div>
                        <% } %>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="right-box-product p-3">
                <form action="/addtocart" method="post" enctype="multipart/form-data">
                    <div class="w-75 m-auto">
                        <div class="spec-picking">
                            <input type="text" name="productid" value="<%= product.product_id %>" hidden>
                            <% let count = 0; %>
                            <% if(product.categories === 'sticker'){ %>
                            <% count++ %>
                            <%- include('./product_select/sticker', { count: count, options: options }) %> 
                            <% } %>
                          
                            <div class="my-4">
                                <h4>การออกแบบ</h4>
                                <hr>
                                <input type="file" class="btn d-block" id="customFile" name="designfile" />
                                <a href="/konva">
                                    <div class="btn btn-secondary d-block mt-3">ออกแบบด้วยเครื่องมือในเว็บ</div>
                                </a>
                            </div>
                            <div class="float-end mt-5">
                                <span>ยอดรวม: </span>
                                <input type="text" name="total_price" id="total-price" readonly>
                                <!-- <span id="total-price">฿0</span> -->
                                <% if(!login){ %>
                                <p>กรุณาเข้าสู่ระบบก่อนที่จะเพิ่มสินค้าลงตระกร้า</p>
                                <% }else if(login === true) { %>
                                <a href="">
                                    <button type="submit"
                                        class="btn btn-primary d-block mt-3">ยืนยันรายการลงตระกร้า</button>
                                </a>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>

<script>
    // function calculatePrice() {
    //     const quantity = parseInt($('#floatingSelect').val());
    //     const quantityPerUnit = parseInt($('#floatingSelect option:selected').data('perUnit'));

    //     const optionPrice = parseFloat($('#option option:selected').data('price'));

    //     const totalPricePerUnit = optionPrice * quantityPerUnit;
    //     const totalPrice = totalPricePerUnit * quantity;

    //     $('#total-price').val(totalPrice.toFixed(2)); // Display the total price in the input field
    // }

    $(document).ready(() => {
        $('.radio-choice, #floatingSelect').change(calculatePrice);
    });

    function calculatePrice() {
        const quantity = parseInt($('#floatingSelect').val());
        const quantityPerUnit = parseInt($('#floatingSelect option:selected').data('perunit'));
        const optionPrice = parseFloat($('#option option:selected').data('price'));

        if (isNaN(quantity) || isNaN(quantityPerUnit) || isNaN(optionPrice)) {
            $('#total-price').val('Invalid selection');
            return;
        }

        const totalPricePerUnit = optionPrice * quantityPerUnit;
        const totalPrice = totalPricePerUnit * quantity;

        $('#total-price').val(totalPrice.toFixed(2));
    }

    // Update the code to set data-perUnit and data-quantity attributes in the quantity select options
    $(document).ready(() => {
        $('.form-select').change(() => {
            const selectedQuantityOption = $('#floatingSelect option:selected');
            const perUnit = selectedQuantityOption.data('perunit');
            const quantity = selectedQuantityOption.val();

            $('.radio-choice option').attr('data-perUnit', perUnit).attr('data-quantity', quantity);
        });
    });



    $(document).ready(() => {
        $('.radio-choice').change(function () {
            const selectedOption = $(this).find('option:selected');
            const imagePath = selectedOption.data('img');
            const index = $('.radio-choice').index(this);
            const selectedImage = $('.selectedimg').eq(index);

            selectedImage.attr('src', imagePath);
        });
    });

    $(document).ready(() => {
        $('.radio-choice').change(function () {
            const selectedOption = $(this).find('option:selected');
            const selectedText = selectedOption.val();
            const index = $(this).closest('.mb-2').attr('id');
            $('#select-option-' + index).text(selectedText);
        });
    });
</script>


<%- include('../partials/footer') %>